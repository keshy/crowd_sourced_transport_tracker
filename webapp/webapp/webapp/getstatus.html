<!doctype html>
<!-- Conditional comment for mobile ie7 http://blogs.msdn.com/b/iemobile/ -->
<!--[if IEMobile 7 ]>    <html class="no-js iem7"> <![endif]-->
<!--[if (gt IEMobile 7)|!(IEMobile)]><!--> <html class="no-js"> <!--<![endif]-->

<head>
  <meta charset="utf-8">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile viewport optimization http://goo.gl/b9SaQ -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Home screen icon  Mathias Bynens http://goo.gl/6nVq0 -->
  <!-- For iPhone 4 with high-resolution Retina display: -->
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/h/apple-touch-icon.png">
  <!-- For first-generation iPad: -->
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/m/apple-touch-icon.png">
  <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon-precomposed" href="img/l/apple-touch-icon-precomposed.png">
  <!-- For nokia devices: -->
  <link rel="shortcut icon" href="img/l/apple-touch-icon.png">

  <!--iOS web app, deletable if not needed -->
  <!--the script prevents links from opening in mobile safari. https://gist.github.com/1042026
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <script>(function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)$/i;a.addEventListener("click",function(a){d=a.target;while(!f.test(d.nodeName))d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}})(document,window.navigator,"standalone")</script>
  <link rel="apple-touch-startup-image" href="img/l/splash.png">-->

  <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
  <meta http-equiv="cleartype" content="on">

  <!-- more tags for your 'head' to consider https://gist.github.com/849231 -->

  <!-- Main Stylesheet -->
 <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>

  

  <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements & feature detects -->
  <script src="js/libs/modernizr-custom.js"></script>
  <!-- Media Queries Polyfill https://github.com/shichuan/mobile-html5-boilerplate/wiki/Media-Queries-Polyfill -->
  <script>Modernizr.mq('(min-width:0)') || document.write('<script src="js/libs/respond.min.js">\x3C/script>')</script>


</head>

<body>

<div data-role="page" id="page2"> 
  <div data-role="header">
    <a data-role="button" data-rel="back" data-icon="arrow-l">Back</a>
    <h1>Get Status</h1>
  </div>
  <div data-role="content">
      <form action="">
    
	<select id="routelist">
	</select>
    
        <select id="stoplist">
       </select>
       <button type="button" id="getstatusbutton" data-theme="a">Get Status</button>
       </form>
  
         
   </div>
 <div id="resultscontainer"/>
       


  <!-- JavaScript at the bottom for fast page loading -->

  <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
 <!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.6.2.min.js"><\/script>')</script>
-->
  <!-- scripts concatenated and minified via ant build script -->
  <script src="js/mylibs/helper.js"></script>
  <!-- end concatenated and minified scripts-->


  <!-- Debugger - remove for production -->
  <!-- <script src="https://getfirebug.com/firebug-lite.js"></script> -->

 
  <script>
      var routeData = null;

      function initStopList(routeId)
    {
        var value = routeId;

        //var html = '<option value="0" selected="true">Select Route</option>';
        var html = '';
        html += '<option value="">Select Stop</option>';
        var len = routeData.routes.length;
        for (var i = 0; i < len; i++) {
            if (routeData.routes[i].routeId == value) {
                var stopsLen = routeData.routes[i].stopList.length;
                for (var j = 0; j < stopsLen; j++) {
                    html += '<option value="' + routeData.routes[i].stopList[j].stopId + '">' + routeData.routes[i].stopList[j].stopName + '</option>';
                }
            }
        }
        $('#stoplist').empty();
        $('#stoplist').append(html);
        $('#stoplist').selectedIndex = 0;
        $('#stoplist').selectmenu("refresh");
    }

    $('#page2').live('pageinit', function (event) {
        //$(document).ready(function () {

        $("#routelist").change(function () {
            initStopList($(this).val());
        });

        $.getJSON('SampleRouteList.txt', function (data) {
            routeData = data;
            //var html = '<option value="0">Select Route</option>';
            var html = '';
            var len = data.routes.length;
            html += '<option value="">Select Route</option>';
            for (var i = 0; i < len; i++) {
                html += '<option value="' + data.routes[i].routeId + '">' + data.routes[i].routeName + '</option>';
            }
            $('#routelist').append(html);


            $('#routelist').selectedIndex = 0;
            $('#routelist').selectmenu("refresh");

            initStopList($('#routelist').val());

        });



        // add markup to container and apply click handlers to anchors
        $("#getstatusbutton").click(function (e) {
            // stop normal link click
            e.preventDefault();

            $.getJSON('SampleGetRoutesResponse.txt', function (data) {
                var html = '<ul data-role="listview" id="resultslist">';
                //var html = '';
                var len = data.data.length;
                for (var i = 0; i < len; i++) {
                    html += '<li>' + data.data[i].routeName + '</li>';
                }
                html += '</ul>'
                //$('#resultslist').empty();
                $('#resultscontainer').html(html);
            });

            //$('#resultscontainer').listview();

            //$('#resultscontainer').listview('refresh');
            //$('#resultslist').listview();
            //$('#resultslist').listview("refresh");
        });
    });
</script>


</div> <!--! end of #container -->

</body>
</html>
